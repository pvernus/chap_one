---
title: "Untitled"
format: docx
editor: visual
bibliography: references.bib
---

```{r, load_pckg}

source(here::here('scripts', 'library.R'))
```

```{r load_data}

# outcome
load(file =  "C:\\Users\\pauvernu\\Seafile\\library\\chap_one_data\\data\\outcome\\data_outcome.RData")
# treatment
load(file = "C:\\Users\\pauvernu\\Seafile\\library\\chap_one_data\\data\\treatment\\data_treatment.RData")
# covariates
load(file = "C:\\Users\\pauvernu\\Seafile\\library\\chap_one_data\\data\\covariate\\data_covariate.RData")
# load(here('data', 'data_covariate.RData'))
```

> NOTE(1): should the typology (categories) be defined here or earlier in data_crs? E.g. data cleaning in `data_crs` and data transformation in `data_sample`
>
> NOTE(2): same question as above for the definition of the observation window.

# Sample

```{r sample_data}

outcome <- data_outcome |> 
  select(donor_id, recipient_id, year, starts_with("commit"), starts_with("sh"))

treatment <- data_treatment |> 
  select(iso3c, year, treat_first_stag, cohort_dis, rel_time)

covariate <- data_covariate |> 
  select(iso3c, year, incomegroup_name, region_agg)

data_sample <- left_join(
  # merge outcome sample
  data_unit, outcome, by = c("donor_id", "recipient_id", "year")) |> 
  # merge treatment sample
  left_join(treatment, by = c("iso3c", "year")) |> 
  # merge covariate sample
  left_join(covariate, by = c("iso3c", "year")) |> 
  mutate(id = paste(donor_id, recipient_id, sep = "_")) |> 
  relocate(id, .before = year)
```

```{r}

outcome_hum <- data_outcome_hum |> 
  select(donor_id, recipient_id, sector_hum, year, starts_with("commit"), starts_with("sh"))

data_sample_hum <- left_join(
  # merge outcome sample
  data_unit_hum, outcome_hum, by = c("donor_id", "recipient_id", "sector_hum", "year")) |> 
  filter(sector_hum != "Other") |> 
  # merge treatment sample
  left_join(treatment, by = c("iso3c", "year")) |> 
  # merge covariate sample
  left_join(covariate, by = c("iso3c", "year")) |> 
  mutate(id = paste(donor_id, recipient_id, sep = "_")) |> 
  relocate(id, .before = year)
```

# Save

```{r save}

save(data_sample, data_sample_hum,
     file = "C:\\Users\\pauvernu\\Seafile\\library\\chap_one_data\\data\\data_sample.RData")
```
